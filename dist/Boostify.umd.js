(function(a,d){typeof exports=="object"&&typeof module<"u"?module.exports=d():typeof define=="function"&&define.amd?define(d):(a=typeof globalThis<"u"?globalThis:a||self,a.boostify=d())})(this,function(){"use strict";var _=Object.defineProperty;var q=(a,d,m)=>d in a?_(a,d,{enumerable:!0,configurable:!0,writable:!0,value:m}):a[d]=m;var g=(a,d,m)=>(q(a,typeof d!="symbol"?d+"":d,m),m);const a={background:"#b8eba9",color:"#444",padding:"3px"},d={background:"#7cc28d",color:"#444",padding:"3px"},m={background:"#065205",color:"#bada55",padding:"3px",marginTop:"10px"};function b(r){return Object.entries(r).map(([e,s])=>`${e}: ${s}`).join("; ")}function $({url:r,inlineScript:e,attributes:s}){const t=document.createElement("script");return r&&(t.src=r),e&&(t.textContent=e),y(t,s),t}function y(r,e){e.forEach(s=>{const[t,o]=s.includes("=")?s.split("="):[s,!0];r.setAttribute(t,o===!0?"":o.replace(/"/g,""))})}function w(r,e){let s;if(console.log("appendTo:",e),e==="head"||e==="body")s=document[e],console.log(`Appending to document.${e}`);else if(typeof e=="string"){if(s=document.querySelector(e),!s)throw console.error("No element matches the selector: "+e),new Error("No element matches the selector: "+e)}else e instanceof Element?s=e:(s=document.head,console.log("Default append to head"));s.appendChild(r)}function D({url:r,inlineStyle:e,attributes:s}){let t;if(r)t=document.createElement("link"),t.rel="stylesheet",t.href=r;else if(e)t=document.createElement("style"),t.textContent=e;else throw new Error('Either "url" or "inlineStyle" must be provided.');return y(t,s),t}async function k({url:r,apiKey:e,strategy:s}){const t=`https://www.googleapis.com/pagespeedonline/v5/runPagespeed?url=${encodeURIComponent(r)}&key=${e}&strategy=${s}&category=performance&category=accessibility&category=seo&category=best-practices`,o=await fetch(t);if(!o.ok)throw new Error("Network response was not ok");return o.json()}async function I(r,e){try{const[s,t]=await Promise.all([k({url:r,apiKey:e,strategy:"mobile"}),k({url:r,apiKey:e,strategy:"desktop"})]);return{performance:{mobile:s.lighthouseResult.categories.performance.score*100,desktop:t.lighthouseResult.categories.performance.score*100},accessibility:{mobile:s.lighthouseResult.categories.accessibility.score*100,desktop:t.lighthouseResult.categories.accessibility.score*100},seo:{mobile:s.lighthouseResult.categories.seo.score*100,desktop:t.lighthouseResult.categories.seo.score*100},bestPractices:{mobile:s.lighthouseResult.categories["best-practices"].score*100,desktop:t.lighthouseResult.categories["best-practices"].score*100}}}catch(s){throw console.error("There was a problem fetching PageSpeed scores:",s),s}}function x(){let r=document.getElementById("pageSpeedResultDiv");return r||(r=document.createElement("div"),r.id="pageSpeedResultDiv",r.style.position="fixed",r.style.bottom="0",r.style.left="0",r.style.backgroundColor="rgba(0, 0, 0, 0.9)",r.style.color="white",r.style.padding="10px",r.style.zIndex="1000",r.style.fontSize="12px",r.style.borderRadius="0 10px 10px 0",document.body.appendChild(r)),r}function O(r){const e=x();e.innerHTML=r}function A(r){return r>=90?"#0f0":r>=51?"#ff0":"#f00"}function C(r,e){const s=x(),t=(n,i)=>{var u;const c=Math.round(((u=r[n])==null?void 0:u[i])??0);return`<span style="color: ${A(c)};">${i.charAt(0).toUpperCase()+i.slice(1)} ${c}</span>`},o=`
        <strong>Boostify Report: ${e}</strong><br>
        <strong>Performance:</strong> ${t("performance","desktop")} / ${t("performance","mobile")}<br>
        <strong>Accessibility:</strong> ${t("accessibility","desktop")} / ${t("accessibility","mobile")}<br>
        <strong>Best Practices:</strong> ${t("bestPractices","desktop")} / ${t("bestPractices","mobile")}<br>
        <strong>SEO:</strong> ${t("seo","desktop")} / ${t("seo","mobile")}<br>`;s.innerHTML=o}const p=r=>r.map(e=>String.fromCharCode(e)).join(""),v={brand:[66,111,111,115,116,105,102,121,74,115],license_approved:[66,111,111,115,116,105,102,121,32,76,105,99,101,110,115,101,32,65,112,112,114,111,118,101,100],license_declined:[66,111,111,115,116,105,102,121,32,76,105,99,101,110,115,101,32,68,101,99,108,105,110,101,100],productId:[97,77,73,73,120,85,116,67,95,79,55,108,98,106,83,70,88,72,53,101,87,81,61,61],APIvalidate:[104,116,116,112,115,58,47,47,97,112,105,46,103,117,109,114,111,97,100,46,99,111,109,47,118,50,47,108,105,99,101,110,115,101,115,47,118,101,114,105,102,121],errorValidate:[69,114,114,111,114,58]},h={debugDefault:"Execution - On Page Load - Will load delay scripts with attribute",scriptLoaded:"Script loaded",scriptNotLoaded:"Script not loaded",events:{load:{positive:"All scripts were executed on load",negative:"Error executing scripts on load"},scroll:{positive:"All scripts were executed on scroll",negative:"Error executing scripts on scroll"},mousemove:{positive:"All scripts were executed on mousemove",negative:"Error executing scripts on mousemove"},touchstart:{positive:"All scripts were executed on touchstart",negative:"Error executing scripts on touchstart"}}},L={debugDefault:"Boostify js - Execution on click event"},S={debugDefault:"Boostify - Execution - On Scroll at",debugDefaultSecond:"from the top of the page"},E={noElement:"ObserverEvent: Provided 'element' is neither a valid DOM element nor a NodeList.",noCallback:"ObserverEvent: Provided 'callback' is not a function.",noObserver:"ObserverEvent: No observer was found for the provided element."};class M{constructor(e){g(this,"_handleScroll",()=>{this.wereScriptsExecuted||(this.wereScriptsExecuted=!0,this.fire().then(()=>{typeof this.callback=="function"&&this.callback({event:"scroll"}),this.debug&&console.log(`%c ${h.events.scroll.positive}`,b(a))}).catch(e=>{this.debug&&console.error(` ${h.events.scroll.negative}`,e)}))});g(this,"_mouseMove",()=>{this.wereScriptsExecuted||(this.wereScriptsExecuted=!0,this.fire().then(()=>{typeof this.callback=="function"&&this.callback({event:"mousemove"}),this.debug&&console.log(`%c ${h.events.mousemove.positive}`,b(a))}).catch(e=>{this.debug&&console.error(`${h.events.mousemove.negative}`,e)}))});g(this,"_touchStart",()=>{this.wereScriptsExecuted||(this.wereScriptsExecuted=!0,this.fire().then(()=>{typeof this.callback=="function"&&this.callback({event:"touchstart"}),this.debug&&console.log(`%c ${h.events.touchstart.positive}`,b(a))}).catch(e=>{this.debug&&console.error(`${h.events.touchstart.negative}`,e)}))});this.debug=e.debug,this.selector="script[type='text/boostify']",this.wereScriptsExecuted=!1,this.maxTime=e.maxTime,this.eventsHandler=e.eventsHandler,this.callback=e.callback,this.init(),this.events()}init(){this.debug&&console.log(`%c ${h.debugDefault}  ${this.selector} on ${this.eventsHandler} after ${this.maxTime}s`,b(a)),setTimeout(()=>{this.wereScriptsExecuted||(this.wereScriptsExecuted=!0,this.fire().then(()=>{typeof this.callback=="function"&&this.callback({event:"onload"}),this.debug&&console.log(`%c ${h.events.load.positive} `,b(a))}).catch(e=>{this.debug&&console.error(`${h.events.load.negative}`,e)}))},this.maxTime)}events(){this.eventsHandler.forEach(e=>{e==="scroll"?window.addEventListener("scroll",this._handleScroll):e==="mousemove"?window.addEventListener("mousemove",this._mouseMove):e==="touchstart"&&window.addEventListener("touchstart",this._touchStart)})}fire(){return new Promise((e,s)=>{const t=document.querySelectorAll(this.selector);if(t.length===0){s(new Error("No scripts with script[type='text/boostify'] found."));return}const o=Array.from(t);let n=0;const i=l=>{if(l.src){const f=document.createElement("script");f.src=l.src,f.onload=()=>{n++,this.debug&&console.log(`${h.scriptLoaded} ${l.src}`),n===o.length&&e()},f.onerror=()=>{s(new Error(`${h.scriptNotLoaded}${l.src}`))},document.body.appendChild(f)}else try{const f=document.createElement("script");f.text=l.innerText,document.body.appendChild(f),n++,n===o.length&&e()}catch(f){s(f)}},c=o.filter(l=>l.src),u=o.filter(l=>!l.src);if(c.forEach(i),c.length===0)u.forEach(i);else{const l=setInterval(()=>{n>=c.length&&(clearInterval(l),u.forEach(i))},100)}})}}class P{constructor(e){this.debug=e.debug,this.DOM={element:e.element},this.callback=e.callback,this.fireInit=this.fireInit.bind(this),this.init()}init(){this.DOM.element.addEventListener("click",this.fireInit)}fireInit(e){e.preventDefault(),this.debug&&console.log(`%c ${L.debugDefault} `,b(d)),typeof this.callback=="function"&&this.callback({event:"click"})}destroy(){this.DOM.element.removeEventListener("click",this.fireInit)}}class N{constructor(e){g(this,"scrollHandler",()=>{!this.wasScrollExecuted&&window.scrollY>=this.distance&&(this.wasScrollExecuted=!0,typeof this.callbackFn=="function"&&this.callbackFn({event:"scroll"}))});this.debug=e.debug,this.distance=e.distance,this.callbackFn=e.callback,this.name=e.name,this.wasScrollExecuted=!1,this.events()}events(){this.debug&&console.log(`%c ${S.debugDefault} ${this.distance} ${S.debugDefaultSecond}`,b(m)),window.addEventListener("scroll",this.scrollHandler)}destroy(){window.removeEventListener("scroll",this.scrollHandler)}}class R{constructor(e){this.debug=e.debug,this.DOM={element:e.element},this.element=e.element,this.callback=e.callback,this.options=e.options,this.observers=[],this.events()}events(){NodeList.prototype.isPrototypeOf(this.element)?this.element.forEach(e=>this.observeElement(e)):this.element instanceof Element?this.observeElement(this.element):console.error(`${E.noElement}`)}observeElement(e){const s=new IntersectionObserver((t,o)=>{t.forEach(n=>{n.isIntersecting&&(typeof this.callback=="function"?this.callback(n,o):console.error(`${E.noCallback}`))})},this.options);s.observe(e),this.observers.push({element:e,observer:s})}destroy(e){const{element:s}=e,t=this.observers.findIndex(o=>o.element===s);t!==-1?(this.observers[t].observer.disconnect(),this.observers.splice(t,1)):console.error(`${E.noObserver}`)}}function H(r,e){const s="https://api.gumroad.com/v2/licenses/verify";return new Promise((t,o)=>{const n=new FormData;n.append("product_id",r),n.append("license_key",e),fetch(s,{method:"POST",body:n}).then(i=>i.json()).then(i=>{t(i)}).catch(i=>{o(i)})})}class T{constructor(e){if(!e||!e.license)throw new Error("License is required");this.productID=p(v.productId),this.license=e.license,this.debug=e.debug||!1,this.events=[],this.vl()}async vl(){try{var e=await H(this.productID,this.license);e.success?this.debug&&console.log(`%c${p(v.brand)} - ${p(v.license_approved)} `,b(m)):(setTimeout(()=>{this.destroyNoMatterWhat()},1200),this.wm())}catch(s){console.error(p(v.errorValidate),s)}}onload(e){this.onload=new M({debug:this.debug,maxTime:e.maxTime?e.maxTime:600,selectors:e.selector!==void 0?e.selector:"type='text/boostify'",eventsHandler:e.eventsHandler?e.eventsHandler:["mousemove","load","scroll","touchstart"],callback:e.callback?e.callback:null});var s={instance:this.onload,type:"onload"};this.events.push(s)}click(e){this.clickEvnt=new P({debug:this.debug,element:e.element?e.element:document.querySelector(".js--click-boostify"),callback:e.callback?e.callback:null});var s={instance:this.clickEvnt,type:"click"};this.events.push(s)}destroyclick(e){const s=e.element||document.querySelector(".js--click-boostify"),t=this.events.findIndex(o=>o.instance.DOM.element===s&&o.type==="click");t!==-1?(this.events[t].instance.destroy(),this.events.splice(t,1)):console.log("Click event not found for element:",s)}scroll(e){const s=e.name||`scroll-${e.distance}`;this.scrollEvent=new N({debug:this.debug,distance:e.distance,callback:e.callback,name:s});var t={name:s,instance:this.scrollEvent,type:"scroll"};this.events.push(t)}destroyscroll(e){const s=e.name||`scroll-${e.distance}`,t=this.events.findIndex(o=>o.type==="scroll"&&o.name===s);t!==-1?(this.events[t].instance.destroy(),this.events.splice(t,1)):console.warn("Scroll event not found for name:",s)}observer(e){var s=e.element;if(!(s instanceof Element))throw new Error(`${v.brand}: Provided 'element' is not a valid DOM element.`);var t={root:null,rootMargin:"0px",threshold:.01},o={...t,...e.options};this.observerEvent=new R({options:o,debug:this.debug,element:e.element?e.element:document.querySelector(".js--observer-boostify"),callback:e.callback});var n={instance:this.observerEvent,type:"observer",elements:e.element instanceof NodeList?[...e.element]:[e.element]};this.events.push(n)}refreshobserver({element:e}={}){this.events.filter(t=>t.type==="observer"&&(!e||t.elements.includes(e))).forEach(t=>{t.instance.observers.forEach(o=>{if(!e||o.element===e){o.observer.disconnect();const n=t.instance.observers.indexOf(o);n>-1&&t.instance.observers.splice(n,1),e&&document.contains(e)&&t.instance.observeElement(e)}}),e||(t.instance.observers=[],Array.isArray(t.elements)&&t.elements.forEach(o=>{document.contains(o)&&t.instance.observeElement(o)}))})}destroyobserver(e){(e.element instanceof NodeList?[...e.element]:[e.element]).forEach(t=>{const o=this.events.findIndex(n=>n.type==="observer"&&Array.isArray(n.elements)&&n.elements.includes(t));o!==-1?(this.events[o].instance.destroy({element:t}),this.events[o].instance.observers.length===0&&this.events.splice(o,1)):console.warn("Observer event not found for element:",t)})}videoPlayer(e){const{url:{ogg:s,mp4:t},attributes:o,appendTo:n,style:i}=e,c=document.createElement("video");c.style.width="100%",c.style.height=i&&i.height?i.height:"auto",i&&Object.keys(i).forEach(l=>{c.style[l]=i[l]});for(let l in o)l==="class"?c.className=o[l]:["loop","muted","controls","autoplay"].includes(l)?c[l]=o[l]:c.setAttribute(l,o[l]);if(s){const l=document.createElement("source");l.setAttribute("src",s),l.setAttribute("type","video/ogg"),c.appendChild(l)}if(t){const l=document.createElement("source");l.setAttribute("src",t),l.setAttribute("type","video/mp4"),c.appendChild(l)}let u;if(typeof n=="string"?u=document.getElementById(n)||document.querySelector(n):n instanceof Element&&(u=n),!u)throw new Error("Append target not found.");u.appendChild(c)}videoEmbed({url:e,autoplay:s=!1,appendTo:t,style:o}){const n=document.createElement("iframe");n.setAttribute("frameborder","0"),n.setAttribute("allowfullscreen",""),n.style.width="100%",n.style.height=o&&o.height?o.height:"100%",o&&Object.keys(o).forEach(c=>{n.style[c]=o[c]}),s&&(e+=`${e.includes("?")?"&":"?"}autoplay=1`,e.includes("youtube.com")||e.includes("youtu.be")?e+="&mute=1":e.includes("vimeo.com")&&(e+="&muted=1")),n.src=e;let i;if(typeof t=="string"?i=document.getElementById(t)||document.querySelector(t):t instanceof Element&&(i=t),!i){console.error("Append target not found.");return}i.innerHTML="",i.appendChild(n)}async loadScript({url:e="",attributes:s=[],appendTo:t="head",inlineScript:o=""}){return new Promise((n,i)=>{if(!e&&!o){i(new Error('Either "url" or "inlineScript" must be provided.'));return}try{const c=$({url:e,inlineScript:o,attributes:s});c.onload=()=>{this.debug&&console.log(`${e} script loaded successfully`),n()},c.onerror=()=>i(new Error(`Script load error for ${e}`)),w(c,t),o&&!e&&n()}catch(c){i(c)}})}async loadStyle({url:e="",attributes:s=[],appendTo:t="head",inlineStyle:o=""}){return new Promise((n,i)=>{try{const c=D({url:e,inlineStyle:o,attributes:s});c.onload=()=>{this.debug&&console.log(`${e} stylesheet loaded successfully`),n()},c.onerror=()=>i(new Error(`Stylesheet load error for ${e}`)),w(c,t),(o||!e)&&n()}catch(c){i(c)}})}async scores(e){const{url:s,apiKey:t,showOnPage:o}=e;if(!s)throw new Error("URL is required");if(!t)throw new Error("API key is required");try{o&&O(`Boostify Loading data from ${s}`);const n=await I(s,t);return o&&C(n,s),n}catch(n){throw console.error("There was a problem within BSTF scores method:",n),n}}destroyNoMatterWhat(){console.log("destroyNoMatterWhat");for(let e=0;e<this.events.length;e++){let s=this.events[e];s.type==="click"&&this.clickEvnt.destroy({element:s.instance.DOM.element}),s.type==="scroll"&&this.scrollEvent.destroy({distance:s.instance.distance}),s.type==="observer"&&(console.log("destroy observer"),this.observerEvent.destroy({element:s.instance.element}))}}wm(){var e=document.createElement("div");e.className=v.brand;var s=document.createElement("h2");s.textContent=v.brand;function t(){Object.assign(e.style,{position:"fixed",right:"10px",padding:"5px",bottom:"10px",background:"grey",zIndex:"1000"}),s.style.fontSize="11px"}t(),e.appendChild(s),document.body.appendChild(e),setInterval(t,1e3)}}return T});
